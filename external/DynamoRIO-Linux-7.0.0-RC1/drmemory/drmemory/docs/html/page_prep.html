<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<title>Dr. Memory: Preparing Your Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dr. Memory
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_prep.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Preparing Your Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>First we give cross-plaform guidelines for how to build your application, before giving specific compiler parameters for each platform.</p>
<h1><a class="anchor" id="sec_prep_general"></a>
For All Platforms</h1>
<p>These cross-platform steps apply to Linux, Mac, and Windows.</p>
<h2><a class="anchor" id="sec_prep_32bit"></a>
32-bit</h2>
<p>Currently, Dr. Memory does not yet support uninitialized read detection for 64-bit applications, so we recommend compiling your target application as 32-bit.</p>
<h2><a class="anchor" id="sec_prep_debuginfo"></a>
Debug Information</h2>
<p>In order to obtain line number information, compile your target application with debugging information enabled. On Linux, Dr. Memory supports ELF files with DWARF2 line information. On Mac, Dr. Memory supports Mach-O files with DWARF2 line information. On Windows, Dr. Memory supports PDB debug information (produced by Visual Studio) as well as PECOFF files with DWARF2 line information (produced by MinGW gcc).</p>
<h2><a class="anchor" id="sec_prep_callstacks"></a>
Callstack Quality</h2>
<p>You'll get better callstacks in error reports if you disable inlining. Dr. Memory should be able to determine callstacks in the presence of frame pointer optimizations (FPO) in most cases, but if you see strange callstacks in an optimized application consider disabling FPO.</p>
<p>If your application links with a static library that was built with frame pointer optimizations and you observe missing frames on your callstacks, try running with the Dr. Memory runtime options <code>-no_callstack_use_top_fp</code>, <code>-no_callstack_use_fp</code>, and <code>-callstack_conservative</code>. These will add some additional overhead on malloc-intensive applications, but should eliminate skipped frames.</p>
<h1><a class="anchor" id="sec_prep_linux"></a>
Linux</h1>
<p>For uninitialized read detection, ensure your Linux installation is able to build 32-bit applications. On 64-bit Ubuntu you will want these packages:</p>
<pre class="fragment">sudo apt-get install g++-multilib
</pre><p>On Ubuntu older than 13.04, the <code>ia32-libs</code> package should also be installed. On 13.04 and higher, 32-bit libraries must be chosen individually, but normally they are installed by default in most distributions.</p>
<p>Dr. Memory currently only supports DWARF2 line information, not stabs. DWARF2 is the default for modern versions of <code>gcc</code>.</p>
<p>Here is a sample command line for compiling your application that combines all of the above recommendations:</p>
<pre class="fragment">g++ -m32 -g -fno-inline -fno-omit-frame-pointer myfile1.cpp myfile2.cpp -o myapp
</pre><h1><a class="anchor" id="sec_prep_mac"></a>
Mac</h1>
<p>Ensure your compiler is able to build 32-bit applications.</p>
<p>Dr. Memory currently only supports DWARF2 line information, not stabs. DWARF2 is the default for modern versions of <code>gcc</code> as well as <code>clang</code>.</p>
<p>Here is a sample command line for compiling your application that combines all of the above recommendations:</p>
<pre class="fragment">c++ -m32 -g -fno-inline -fno-omit-frame-pointer myfile1.cpp myfile2.cpp -o myapp
</pre><h1><a class="anchor" id="sec_prep_windows"></a>
Windows Visual Studio</h1>
<p>Visual Studio builds 32-bit applications by default, so no action is required on that front.</p>
<p>To include debug information, use the <code>/Zi</code> flag to the Visual Studio compiler. From the IDE, Press Alt-F7 to bring up the configuration properties of your build target. Under "Configuration Properties | C/C++ |
General", the "Debug Information Format" entry should either say "Program
Database (/Zi)" or "Program Database for Edit and Continue (/ZI)". Additionally, under "Configuration Properties | Linker | Debugging", the "Generate Debug Info" entry should say "Yes (/DEBUG)". For Visual Studio 2015, under "Configuration Properties | Linker | Debugging", the "Generate Debug Info" entry should say "Optimize for debugging (/DEBUG)" &ndash; it should <em>not</em> say "Optimize for faster linking (/DEBUG:FASTLINK)".</p>
<p>To disable inlining as recommended above, use the <code>/Ob0</code> parameter. In the Visual Studio IDE, press Alt-F7 and then under "Configuration
Properties | C/C++ | Optimization" ensure "Inline Function Expansion" says "Disabled (/Ob0)".</p>
<p>To disable frame pointer optimization as recommended above, use the <code>Oy-</code> parameter. In the Visual Studio IDE, press Alt-F7 and then under "Configuration Properties | C/C++ | Optimization" ensure "Omit Frame
Pointers" says "No (/Oy-)".</p>
<h2><a class="anchor" id="sec_prep_win_libc"></a>
C Library Interactions</h2>
<p>All combinations of the debug or release C library, linked statically or dynamically, are supported. When using static versions of msvcrt (the <code>/MTd</code> or <code>/MT</code> flags), if your application does not have symbols then Dr. Memory will not be able to identify memory allocation calls, which may lead to false positives and/or false negatives. Be sure to build with debugging information included using the instructions above.</p>
<p>The debug C library (specified with the <code>/MDd</code> or <code>/MTd</code> flags) contains its own redzone and heap error checks. Dr. Memory completely replaces these checks with its own, more complete checks.</p>
<h2><a class="anchor" id="sec_prep_win_rtc"></a>
Disable Runtime Checks</h2>
<p>The Visual Studio compiler's <code>/RTC1</code> flag can prevent Dr. Memory from reporting uninitialized reads of local variables, and the <code>/RTC1</code> checks for uninitialized reads themselves may not catch everything that Dr. Memory finds. However, <code>/RTC1</code> does perform additional stack checks that Dr. Memory does not, so for best results, your application should be run under Dr. Memory without <code>/RTC1</code>, and run natively with <code>/RTC1</code>.</p>
<p>In the Visual Studio IDE, press Alt-F7 and then under "Configuration
Properties | C/C++ | Code Generation" ensure "Basic Runtime Checks" says "Default".</p>
<h2><a class="anchor" id="sec_prep_win_sum"></a>
Parameter Summary</h2>
<p>Here is a sample command line for Visual Studio:</p>
<pre class="fragment">cl /Zi /MT /EHsc /Oy- /Ob0 /Femyapp.exe *.cpp
</pre><h1><a class="anchor" id="sec_prep_mingw"></a>
Windows MinGW</h1>
<p>Dr. Memory supports applications compiled with the MinGW gcc or g++ compilers, but will only provide line number information if DWARF2 debugging information is present. The default for MinGW gcc prior to version 4.3 is to use the stabs format, which is not supported by Dr. Memory. Pass the <code>-ggdb</code> option to gcc to generate DWARF2 format instead.</p>
<p>You install the MinGW compiler in a Cygwin installation by running the Cygwin installer (<code>setup.exe</code>), searching for "mingw", opening Devel, and installing <code>mingw-gcc-g++</code>. Alternatively, MinGW can be installed on its own.</p>
<p>For MinGW C++ applications, we recommending building with static libstdc++ libraries. Pass <code>-static-libgcc -static-libstdc++</code> to g++ to request this. These static libraries contain frame pointer optimizations but Dr. Memory automatically enables the <code>-no_callstack_use_top_fp</code> runtime option for MinGW applications.</p>
<p>Here is a sample command line for MinGW, using the "mingw64-i686-gcc-g++:
GCC for Win32 (i686-w64-mingw32) toolchain (C++)" Cygwin package (this is a 32-bit compiler available for both 32-bit and 64-bit Cygwin):</p>
<pre class="fragment">i686-w64-mingw32-g++.exe -static-libgcc -static-libstdc++ -ggdb -o myapp.exe myfile1.cpp myfile2.cpp
</pre><h1><a class="anchor" id="sec_prep_cygwin"></a>
Windows Cygwin: Not Supported</h1>
<p>Currently there is no support for applications built with Cygwin gcc or g++.</p>
<p>The regular Dr. Memory build can be executed just fine from a Cygwin shell when targeting non-Cygwin applications.</p>
<h1><a class="anchor" id="sec_prep_android"></a>
Android</h1>
<p>Build your application using the Android NDK and copy it over to your device. Be sure to compile with debugging information included and to disable FPO, as described in <a class="el" href="page_prep.html#sec_prep_general">For All Platforms</a>.</p>
<p>While Java applications are not yet officially supported, we welcome contributions to help work toward full Android Java support. To launch an Android Java application under Dr. Memory, use a wrapper script and point at the script via the <code>logwrapper</code> property set on your application's name prefixed by <code><code>wrap</code>.</code>. For example, if your application's name is <code>com.myco.appname</code>, set the property for <code>wrap.com.myco.appname</code>, truncating to 31 characters:</p>
<div class="fragment"><div class="line">setprop wrap.com.myco.appname <span class="stringliteral">&quot;logwrapper /system/xbin/wrap.sh&quot;</span></div>
</div><!-- fragment --><p>The wrapper shell script should contain the command line prefix you wish to use to launch your application under Dr. Memory. It should also set <code>TMPDIR</code> to point to the directory for your application, which is a location where SElinux allows writing:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#!/system/bin/sh</span></div>
<div class="line">export TMPDIR=/data/data/com.myco.appname</div>
<div class="line">exec /system/xbin/drmemory/bin/drmemory -- $@</div>
</div><!-- fragment --><p>See also the information on SElinux and writable directories under <a class="el" href="page_install_android.html">Installing on Android</a>. Be sure to place the Dr. Memory binaries and the wrapper script in an executable location, such as <code>/system/xbin</code>. Alternatively, disable SELinux via <code>setenforce 0</code>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  Dr. Memory version 1.11.1 --- Fri Feb 3 2017 00:38:43 &nbsp; <img border=0 src="favicon.png">
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
